<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Generador Comprobantes Yikun</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>

body{
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    color:white;
    margin:0;
    padding:30px;
}

.contenedor{
    max-width:900px;
    margin:auto;
    background:rgba(255,255,255,0.05);
    padding:25px;
    border-radius:15px;
    backdrop-filter: blur(10px);
}

h1{
    text-align:center;
    margin-bottom:30px;
}

label{
    font-size:14px;
}

input, select{
    width:100%;
    padding:8px;
    margin:5px 0 15px 0;
    border-radius:5px;
    border:none;
}

table{
    width:100%;
    border-collapse:collapse;
    margin-bottom:15px;
}

th, td{
    border:1px solid rgba(255,255,255,0.2);
    padding:8px;
    text-align:center;
}

th{
    background:rgba(255,255,255,0.1);
}

button{
    padding:10px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    margin-top:10px;
}

.btn{
    background:#00c6ff;
    color:white;
    width:100%;
}

.btn:hover{
    background:#0072ff;
}

.historial{
    margin-top:40px;
    background:rgba(255,255,255,0.05);
    padding:20px;
    border-radius:10px;
}

.recibo{
    width:148mm;
    height:210mm;
    padding:15mm;
    box-sizing:border-box;
    background:white;
    color:black;
}

.logo{
    display:block;
    margin:auto;
    max-width:150px;
}

.print-area{
    display:none;
}

</style>
</head>

<body>

<div class="contenedor">

<h1>Generador Comprobantes Yikun</h1>

<label>Fecha</label>
<input type="date" id="fecha">

<label>Cliente</label>
<input type="text" id="cliente">

<label>Vendedor</label>
<select id="vendedor">
<option>Osvaldo Castillo</option>
<option>Agregá tus vendedores aquí</option>
</select>

<h3>Productos</h3>

<table>
<thead>
<tr>
<th>Detalle</th>
<th>Cantidad</th>
<th>Precio Unit.</th>
</tr>
</thead>
<tbody>
<tr>
<td><input type="text" id="detalle"></td>
<td><input type="number" id="cantidad"></td>
<td><input type="number" id="precio"></td>
</tr>
</tbody>
</table>

<label>Descuento</label>
<select id="descuento">
<option value="0">Sin descuento</option>
<option value="5">5%</option>
<option value="10">10%</option>
<option value="15">15%</option>
</select>

<label>Método de Pago</label>
<select id="pago">
<option>Efectivo</option>
<option>Transferencia</option>
</select>

<button class="btn" onclick="generar()">Generar y Guardar PDF</button>

</div>

<div class="historial">
<h2>Historial de Comprobantes</h2>
<table>
<thead>
<tr>
<th>N°</th>
<th>Cliente</th>
<th>Total</th>
<th>Pago</th>
<th>PDF</th>
</tr>
</thead>
<tbody id="historial"></tbody>
</table>
</div>

<div id="printArea" class="print-area"></div>

<script>

let numeroActual = localStorage.getItem("numeroRecibo") || 1;
numeroActual = parseInt(numeroActual);

let historial = JSON.parse(localStorage.getItem("historialRecibos")) || [];

function guardarHistorial(){
    localStorage.setItem("historialRecibos", JSON.stringify(historial));
    renderHistorial();
}

function renderHistorial(){
    let tabla = document.getElementById("historial");
    tabla.innerHTML = "";

    historial.forEach((recibo, index)=>{
        tabla.innerHTML += `
        <tr>
        <td>${recibo.numero}</td>
        <td>${recibo.cliente}</td>
        <td>$${recibo.total}</td>
        <td>${recibo.pago}</td>
        <td><button onclick="descargar(${index})">PDF</button></td>
        </tr>
        `;
    });
}

function descargar(index){
    generarPDF(historial[index]);
}

function generar(){

let fecha = document.getElementById("fecha").value;
let cliente = document.getElementById("cliente").value;
let vendedor = document.getElementById("vendedor").value;
let detalle = document.getElementById("detalle").value;
let cantidad = parseFloat(document.getElementById("cantidad").value);
let precio = parseFloat(document.getElementById("precio").value);
let descuento = parseFloat(document.getElementById("descuento").value);
let pago = document.getElementById("pago").value;

let subtotal = cantidad * precio;
let descuentoCalc = subtotal * (descuento/100);
let total = (subtotal - descuentoCalc).toFixed(2);

let numeroFormateado = numeroActual.toString().padStart(4,'0');

let recibo = {
numero: numeroFormateado,
fecha,
cliente,
vendedor,
detalle,
cantidad,
precio,
total,
pago
};

historial.push(recibo);
guardarHistorial();

generarPDF(recibo);

numeroActual++;
localStorage.setItem("numeroRecibo", numeroActual);

}

function generarPDF(data){

let contenido = `
<div class="recibo">
<img src="Logo.png" class="logo">
<h2 style="text-align:center;">Comprobante N° ${data.numero}</h2>
<p><strong>Fecha:</strong> ${data.fecha}</p>
<p><strong>Cliente:</strong> ${data.cliente}</p>
<p><strong>Vendedor:</strong> ${data.vendedor}</p>
<table style="width:100%;border-collapse:collapse;">
<tr>
<th style="border:1px solid black;">Detalle</th>
<th style="border:1px solid black;">Cant.</th>
<th style="border:1px solid black;">Precio</th>
</tr>
<tr>
<td style="border:1px solid black;">${data.detalle}</td>
<td style="border:1px solid black;">${data.cantidad}</td>
<td style="border:1px solid black;">$${data.precio}</td>
</tr>
</table>
<p><strong>Método de Pago:</strong> ${data.pago}</p>
<h3 style="text-align:right;">Total: $${data.total}</h3>
</div>
`;

document.getElementById("printArea").innerHTML = contenido + contenido;

html2pdf().from(document.getElementById("printArea")).set({
margin:10,
filename:Recibo_${data.numero}.pdf,
html2canvas:{scale:2},
jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}
}).save();

}

renderHistorial();

</script>

</body>
</html>
