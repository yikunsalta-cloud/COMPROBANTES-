<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Sistema de Recibos</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
body{
    font-family: Arial;
    margin:20px;
}

input, select{
    padding:5px;
    margin:3px;
}

table{
    width:100%;
    margin-top:10px;
    border-collapse: collapse;
}

th, td{
    border:1px solid #000;
    padding:5px;
    text-align:center;
}

button{
    padding:10px;
    margin-top:10px;
    background:#000;
    color:white;
    border:none;
    cursor:pointer;
}

#printArea{
    position:absolute;
    left:-9999px;
}
</style>
</head>

<body>

<h2>Generador de Comprobantes</h2>

<label>Vendedor:</label>
<select id="vendedor">
    <option value="03">03 Lucas A.Grafica</option>
    <option value="02">02 Analia A.Papeleria</option>
</select>

<br><br>

<table>
<tr>
    <th>Detalle</th>
    <th>Cantidad</th>
    <th>Precio</th>
</tr>

<tr>
    <td><input class="detalle"></td>
    <td><input class="cantidad" type="number"></td>
    <td><input class="precio" type="number"></td>
</tr>

<tr>
    <td><input class="detalle"></td>
    <td><input class="cantidad" type="number"></td>
    <td><input class="precio" type="number"></td>
</tr>

<tr>
    <td><input class="detalle"></td>
    <td><input class="cantidad" type="number"></td>
    <td><input class="precio" type="number"></td>
</tr>
</table>

<br>

<label>Descuento:</label>
<input type="number" id="descuento">

<label>Seña:</label>
<input type="number" id="sena">

<br><br>

<label>Método de Pago:</label>
<select id="pago">
<option>Efectivo</option>
<option>Transferencia</option>
</select>

<br>

<button onclick="generar()">Generar PDF</button>

<div id="printArea"></div>

<script>

let numeroActual = localStorage.getItem("numeroRecibo") || 1;
numeroActual = parseInt(numeroActual);

function generar(){

    let detalles = document.getElementsByClassName("detalle");
    let cantidades = document.getElementsByClassName("cantidad");
    let precios = document.getElementsByClassName("precio");

    let totalPedido = 0;
    let filas = "";

    for(let i=0;i<detalles.length;i++){

        if(detalles[i].value !== ""){

            let cant = parseFloat(cantidades[i].value || 0);
            let precio = parseFloat(precios[i].value || 0);
            let subtotal = cant * precio;

            totalPedido += subtotal;

            filas += `
            <tr>
                <td>${detalles[i].value}</td>
                <td>${cant}</td>
                <td>$${precio.toLocaleString()}</td>
            </tr>`;
        }
    }

    let sena = parseFloat(document.getElementById("sena").value || 0);
    let descuento = parseFloat(document.getElementById("descuento").value || 0);
    let metodoPago = document.getElementById("pago").value;

    let totalFinal = totalPedido - descuento;
    let pendiente = totalFinal - sena;

    let hoy = new Date();
    let fechaActual = hoy.toLocaleDateString("es-AR");

    let vendedorSeleccionado = document.getElementById("vendedor").value;
    let datosVendedor = "";

    if(vendedorSeleccionado === "03"){
        datosVendedor = `
        Vendedor: 03 Lucas A.Grafica<br>
        Local: Salta Cap. - Ayacucho 1621<br>
        Cel: 3875729428
        `;
    }

    if(vendedorSeleccionado === "02"){
        datosVendedor = `
        Vendedor: 02 Analia A.Papeleria<br>
        Local: Salta Cap. - Ayacucho 1621<br>
        Cel: 3872254054
        `;
    }

    let numeroFormateado = numeroActual.toString().padStart(4,'0');

    let contenido = `
    <div style="padding:20px; font-family:Arial;">

        <div style="text-align:center;">
            <img src="Logo.png" style="max-width:150px; opacity:0.15;">
        </div>

        <div style="display:flex; justify-content:space-between; font-weight:bold;">
            <span>Comprobante N° ${numeroFormateado}</span>
            <span>${fechaActual}</span>
        </div>

        <br>

        ${datosVendedor}

        <br>

        <table style="width:100%; border-collapse:collapse;" border="1">
            <tr>
                <th>Detalle</th>
                <th>Cantidad</th>
                <th>Precio</th>
            </tr>
            ${filas}
        </table>

        <br>

        <strong>Total Pedido:</strong> $${totalPedido.toLocaleString()}<br>
        <strong>Descuento:</strong> $${descuento.toLocaleString()}<br>
        <strong>Total Final:</strong> $${totalFinal.toLocaleString()}<br>
        <strong>Seña:</strong> $${sena.toLocaleString()}<br>
        <strong>Pendiente:</strong> $${pendiente.toLocaleString()}<br>
        <strong>Método de Pago:</strong> ${metodoPago}

    </div>
    `;

    document.getElementById("printArea").innerHTML = contenido + contenido;

    html2pdf().from(document.getElementById("printArea")).set({
        margin:0,
        filename:Recibo_${numeroFormateado}.pdf,
        html2canvas:{scale:2},
        jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}
    }).save();

    numeroActual++;
    localStorage.setItem("numeroRecibo", numeroActual);
}

</script>

</body>
</html>
