<script>

let numero = localStorage.getItem("numeroYikun") || 3281;
numero = parseInt(numero);

function formatoARS(valor){
    return valor.toLocaleString("es-AR", {
        style:"currency",
        currency:"ARS"
    });
}

function agregarFila(){
    let tabla = document.getElementById("tabla");
    let fila = tabla.insertRow();
    fila.innerHTML = `
    <td><input type="text" class="detalle"></td>
    <td><input type="number" class="cantidad" min="1"></td>
    <td><input type="number" class="precio" min="0" step="0.01"></td>
    `;
}

function generar(){

    let cliente = document.getElementById("cliente").value.trim();
    if(cliente === ""){
        alert("Ingresá el nombre del cliente.");
        return;
    }

    let detalles = document.getElementsByClassName("detalle");
    let cantidades = document.getElementsByClassName("cantidad");
    let precios = document.getElementsByClassName("precio");

    let totalPedido = 0;
    let filas = "";

    for(let i=0;i<detalles.length;i++){
        if(detalles[i].value !== ""){

            let cant = parseFloat(cantidades[i].value || 0);
            let precio = parseFloat(precios[i].value || 0);
            let subtotal = cant * precio;

            totalPedido += subtotal;

            filas += `
            <tr>
                <td>${detalles[i].value}</td>
                <td>${cant}</td>
                <td>${formatoARS(precio)}</td>
            </tr>`;
        }
    }

    if(totalPedido === 0){
        alert("Agregá al menos un producto.");
        return;
    }

    let sena = parseFloat(document.getElementById("sena").value || 0);
    let porcentaje = parseFloat(document.getElementById("descuento").value);

    let montoDescuento = totalPedido * (porcentaje / 100);
    let totalFinal = totalPedido - montoDescuento;
    let pendiente = totalFinal - sena;

    if(pendiente < 0) pendiente = 0;

    let fechaActual = new Date().toLocaleDateString("es-AR");
    let numeroFormateado = numero.toString().padStart(6,'0');

    let comprobanteHTML = `
    <div class="comprobante">

        <div style="text-align:center; margin-bottom:15px;">
            <div style="font-size:28px; font-weight:bold;">Yikun</div>
            <div style="font-size:14px;">Comprobante</div>
        </div>

        <div class="header-recibo">
            <div>Recibo B - ${numeroFormateado}</div>
            <div>Fecha: ${fechaActual}</div>
        </div>

        <p><strong>Cliente:</strong> ${cliente}</p>

        <table>
            <tr>
                <th>Detalle</th>
                <th>Cantidad</th>
                <th>Precio Unit.</th>
            </tr>
            ${filas}
        </table>

        <p><strong>Total Pedido:</strong> ${formatoARS(totalPedido)}</p>
        <p><strong>Descuento (${porcentaje}%):</strong> ${formatoARS(montoDescuento)}</p>
        <p><strong>Seña:</strong> ${formatoARS(sena)}</p>

        <div class="total-pendiente">
            Total Pendiente: ${formatoARS(pendiente)}
        </div>
    </div>
    `;

    document.getElementById("resultado").innerHTML = comprobanteHTML;

    numero++;
    localStorage.setItem("numeroYikun", numero);
}

</script>
