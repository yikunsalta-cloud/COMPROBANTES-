<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Comprobantes Yikun</title>

<style>

body{
    font-family: Arial, sans-serif;
    background:#e9ecef;
    padding:20px;
}

.container{
    max-width:1000px;
    margin:auto;
    background:white;
    padding:25px;
    border-radius:8px;
    box-shadow:0 4px 12px rgba(0,0,0,0.08);
}

h2{
    text-align:center;
    margin-bottom:25px;
    color:#1f1f1f;
}

label{
    font-weight:bold;
    color:#333;
}

input, select{
    padding:7px;
    margin:4px 0;
    border:1px solid #ccc;
    border-radius:4px;
}

table{
    width:100%;
    border-collapse:collapse;
    margin-top:10px;
}

th{
    background:#1f1f1f;
    color:white;
}

th, td{
    border:1px solid #bbb;
    padding:7px;
    text-align:center;
}

/* BOTONES */

button{
    padding:9px 18px;
    margin-top:10px;
    font-weight:bold;
    border:none;
    border-radius:4px;
    cursor:pointer;
    color:white;
}

.btn-agregar{ background:#6c757d; }
.btn-generar{ background:#1e3a5f; }
.btn-imprimir{ background:#343a40; }

button:hover{ opacity:0.9; }

/* AREA IMPRESION */

.area-impresion{
    display:flex;
    flex-wrap:wrap;
    gap:10px;
    justify-content:center;
}

.comprobante{
    width:210mm;
    height:148mm;
    border:2px solid #000;
    padding:20px;
    background:white;
    box-sizing:border-box;
    font-size:14px;
}

.logo-container{
    text-align:center;
    margin-bottom:10px;
}

.logo{
    max-width:160px;
}

.header-recibo{
    display:flex;
    justify-content:space-between;
    font-weight:bold;
    margin-bottom:10px;
    font-size:16px;
}

.total-pendiente{
    font-size:22px;
    color:#b00000;
    font-weight:bold;
    text-align:right;
    margin-top:10px;
}

.datos-vendedor{
    margin-top:15px;
    font-size:13px;
}

/* IMPRESION A4 CON 2 A5 */

@media print {

  @page {
    size: A4 portrait;
    margin: 10mm;
  }

  body * {
    visibility: hidden;
  }

  .area-impresion, .area-impresion * {
    visibility: visible;
  }

  .area-impresion{
    position:absolute;
    top:0;
    left:0;
    width:100%;
  }

  .comprobante{
    page-break-inside: avoid;
    margin-bottom:10mm;
  }

  button, input, select, h2 {
    display:none;
  }
}

</style>
</head>
<body>

<div class="container">

<h2>Generador Comprobantes Yikun</h2>

<label>Cliente:</label><br>
<input type="text" id="cliente"><br>

<label>Vendedor:</label><br>
<select id="vendedor">
    <option value="03">03 Lucas A. Gráfica</option>
    <option value="02">02 Analía A. Papelería</option>
</select>

<h3>Productos</h3>

<table id="tabla">
<tr>
<th>Detalle</th>
<th>Cantidad</th>
<th>Precio Unit.</th>
</tr>
<tr>
<td><input type="text" class="detalle"></td>
<td><input type="number" class="cantidad" min="1"></td>
<td><input type="number" class="precio" min="0" step="0.01"></td>
</tr>
</table>

<button class="btn-agregar" onclick="agregarFila()">Agregar Producto</button>

<br><br>

<label>Seña:</label>
<input type="number" id="sena" value="0" min="0">

<label>Descuento:</label>
<select id="descuento">
    <option value="0">Sin descuento</option>
    <option value="5">5%</option>
    <option value="10">10%</option>
    <option value="15">15%</option>
</select>

<br><br>

<button class="btn-generar" onclick="generar()">Generar</button>
<button class="btn-imprimir" onclick="window.print()">Imprimir</button>

<div class="area-impresion" id="resultado"></div>

</div>

<script>

let numero = localStorage.getItem("numeroYikun");
if(!numero){
    numero = 3281;
}else{
    numero = parseInt(numero);
}

function formatoARS(valor){
    return valor.toLocaleString("es-AR", {
        style:"currency",
        currency:"ARS"
    });
}

function agregarFila(){
    let tabla = document.getElementById("tabla");
    let fila = tabla.insertRow();
    fila.innerHTML = `
    <td><input type="text" class="detalle"></td>
    <td><input type="number" class="cantidad" min="1"></td>
    <td><input type="number" class="precio" min="0" step="0.01"></td>
    `;
}

function generar(){

    let detalles = document.getElementsByClassName("detalle");
    let cantidades = document.getElementsByClassName("cantidad");
    let precios = document.getElementsByClassName("precio");

    let totalPedido = 0;
    let filas = "";

    for(let i=0;i<detalles.length;i++){
        if(detalles[i].value.trim() !== ""){
            let cant = parseFloat(cantidades[i].value || 0);
            let precio = parseFloat(precios[i].value || 0);
            let subtotal = cant * precio;
            totalPedido += subtotal;

            filas += `
            <tr>
                <td>${detalles[i].value}</td>
                <td>${cant}</td>
                <td>${formatoARS(precio)}</td>
            </tr>`;
        }
    }

    if(totalPedido === 0){
        alert("Agregá al menos un producto.");
        return;
    }

    let sena = parseFloat(document.getElementById("sena").value || 0);
    let porcentaje = parseFloat(document.getElementById("descuento").value);

    let montoDescuento = totalPedido * (porcentaje / 100);
    let totalFinal = totalPedido - montoDescuento;
    let pendiente = totalFinal - sena;

    let fechaActual = new Date().toLocaleDateString("es-AR");

    let vendedorSeleccionado = document.getElementById("vendedor").value;

    let datosVendedor = "";

    if(vendedorSeleccionado === "03"){
        datosVendedor = `
        Vendedor: 03 Lucas A. Gráfica<br>
        Local: Salta Cap. - Ayacucho 1621<br>
        Cel: 3875729428
        `;
    }

    if(vendedorSeleccionado === "02"){
        datosVendedor = `
        Vendedor: 02 Analía A. Papelería<br>
        Local: Salta Cap. - Ayacucho 1621<br>
        Cel: 3872254054
        `;
    }

    let comprobanteHTML = `
    <div class="comprobante">
        <div class="logo-container">
            <img src="logo.png" class="logo">
        </div>

        <div class="header-recibo">
            <div>Recibo B - ${numero.toString().padStart(6,'0')}</div>
            <div>Fecha: ${fechaActual}</div>
        </div>

        <p><strong>Cliente:</strong> ${document.getElementById("cliente").value}</p>

        <table>
            <tr>
                <th>Detalle</th>
                <th>Cantidad</th>
                <th>Precio Unit.</th>
            </tr>
            ${filas}
        </table>

        <p><strong>Total Pedido:</strong> ${formatoARS(totalPedido)}</p>
        <p><strong>Descuento (${porcentaje}%):</strong> ${formatoARS(montoDescuento)}</p>
        <p><strong>Seña:</strong> ${formatoARS(sena)}</p>

        <div class="total-pendiente">
            Total Pendiente: ${formatoARS(pendiente)}
        </div>

        <div class="datos-vendedor">
            ${datosVendedor}
        </div>
    </div>
    `;

    document.getElementById("resultado").innerHTML += comprobanteHTML;

    numero++;
    localStorage.setItem("numeroYikun", numero);
}

</script>

</body>
</html>
