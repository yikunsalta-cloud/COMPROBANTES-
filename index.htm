<script>

function generar(){

    let cliente = document.getElementById("cliente").value.trim();
    if(cliente===""){ alert("Ingrese nombre del cliente"); return; }

    let vendedorSelect = document.getElementById("vendedor");
    let nombreVendedor = vendedorSelect.options[vendedorSelect.selectedIndex].text;

    let detalles = document.getElementsByClassName("detalle");
    let cantidades = document.getElementsByClassName("cantidad");
    let precios = document.getElementsByClassName("precio");

    let totalPedido = 0;
    let filas = "";

    for(let i=0;i<detalles.length;i++){
        if(detalles[i].value!==""){
            let cant = parseFloat(cantidades[i].value || 0);
            let precio = parseFloat(precios[i].value || 0);
            totalPedido += cant * precio;

            filas += `
            <tr>
                <td>${detalles[i].value}</td>
                <td>${cant}</td>
                <td>${formatoARS(precio)}</td>
            </tr>`;
        }
    }

    if(totalPedido===0){ alert("Agregue productos"); return; }

    let sena = parseFloat(document.getElementById("sena").value || 0);
    let porcentaje = parseFloat(document.getElementById("descuento").value || 0);
    let descuento = totalPedido*(porcentaje/100);
    let totalFinal = totalPedido-descuento;
    let pendiente = totalFinal-sena;
    if(pendiente<0) pendiente=0;

    let fecha = new Date().toLocaleDateString("es-AR");
    let numeroFormateado = numero.toString().padStart(6,'0');

    let comprobanteHTML="";

    for(let i=0;i<2;i++){

        comprobanteHTML+=`
        <div class="comprobante">

            <img src="logo.png" style="width:150px; display:block; margin:auto;">

            <div class="header-comprobante">
                <div class="header-derecha">
                    <div><strong>Fecha:</strong> ${fecha}</div>
                    <div><strong>Recibo B:</strong> ${numeroFormateado}</div>
                    <div><strong>Cliente:</strong> ${cliente}</div>
                    <div><strong>Vendedor:</strong> ${nombreVendedor}</div>
                </div>
            </div>

            <table>
                <tr>
                    <th>Detalle</th>
                    <th>Cantidad</th>
                    <th>Precio</th>
                </tr>
                ${filas}
            </table>

            <div class="footer-comprobante">
                
                <div class="footer-izquierda">
                    <div>Total Pedido: ${formatoARS(totalPedido)}</div>
                    <div>Descuento: ${formatoARS(descuento)}</div>
                    <div>Se√±a: ${formatoARS(sena)}</div>
                    <div class="saldo-rojo">
                        Saldo Pendiente: ${formatoARS(pendiente)}
                    </div>
                </div>

                <div class="footer-derecha">
                    <div><strong>Datos del Vendedor</strong></div>
                    <div>Local: Salta Capital</div>
                    <div>Ayacucho 1621</div>
                    <div>Tel: 3875XXXXXX</div>
                </div>

            </div>

        </div>
        <hr style="margin:40px 0;">
        `;
    }

    document.getElementById("resultado").innerHTML = comprobanteHTML;

    numero++;
    localStorage.setItem("numeroYikun",numero);
}

</script>
