<!DOCTYPE html>
<html lang="es">
<head>

<meta charset="UTF-8">

<title>Yikun - Comprobantes</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>

body{
margin:0;
font-family:Arial;
background:#FA551D;
color:white;
}

.header{
text-align:center;
padding:25px 0;
}

.header img{
width:220px;
}

.container{
display:flex;
gap:20px;
padding:20px;
}

.panel{
background:#013337;
padding:20px;
border-radius:15px;
width:380px;
}

input,select{
width:100%;
padding:10px;
margin-top:6px;
margin-bottom:12px;
border:none;
border-radius:6px;
background:#21273F;
color:white;
}

button{
border:none;
cursor:pointer;
font-weight:bold;
border-radius:6px;
}

.btn-accion{
background:#149EF6;
color:white;
padding:12px;
width:100%;
margin-top:10px;
}

.btn-agregar{
background:#FA551D;
color:white;
padding:12px;
width:100%;
margin-top:15px;
}

table{
width:100%;
border-collapse:separate;
border-spacing:12px 10px;
}

th{
background:#013337;
padding:12px;
border-radius:8px;
text-align:center;
}

td input{
width:100%;
padding:10px;
border-radius:6px;
border:1px solid #013337;
background:#0f172a;
color:white;
}

#resultado{
margin:0 auto;
background:white;
}

</style>

</head>

<body>

<div class="header">
<img src="logo.png">
</div>

<div class="container">

<div class="panel">

Cliente
<input id="cliente">

Vendedor
<select id="vendedor">
<option value="03">03 Lucas A.Grafica</option>
<option value="02">02 Analia A.Papeleria</option>
</select>

Seña
<input type="number" id="sena" value="0">

Descuento %
<input type="number" id="descuento" value="0">

<button class="btn-accion" onclick="generar()">
GENERAR COMPROBANTE
</button>

<button class="btn-accion" onclick="guardarPDF()">
GUARDAR PDF
</button>

</div>


<div style="flex:1;background:#21273F;padding:20px;border-radius:15px;">

<table id="tabla">

<tr>
<th>Detalle</th>
<th>Cantidad</th>
<th>Precio</th>
</tr>

<tr>
<td><input class="detalle"></td>
<td><input class="cantidad" type="number" value="1"></td>
<td><input class="precio" type="number" value="0"></td>
</tr>

</table>

<button class="btn-agregar" onclick="agregarFila()">
AGREGAR PRODUCTO
</button>

</div>

</div>


<div id="resultado"></div>


<script>

let numero = localStorage.getItem("numeroYikun");

if(!numero){
numero=1;
}else{
numero=parseInt(numero);
}



function formatoARS(num){
return "$ "+num.toLocaleString("es-AR");
}



function agregarFila(){

let tabla=document.getElementById("tabla");

let fila=tabla.insertRow();

fila.innerHTML=`

<td><input class="detalle"></td>

<td><input class="cantidad" type="number" value="1"></td>

<td><input class="precio" type="number" value="0"></td>

`;

}

function generar(){

let cliente=document.getElementById("cliente").value.trim();

if(cliente===""){
alert("Ingrese nombre del cliente");
return;
}

let vendedor=document.getElementById("vendedor").value;

let nombreVendedor="";
let datosVendedor="";

if(vendedor=="03"){
nombreVendedor="03 Lucas A.Grafica";
datosVendedor="Local: Salta Cap. - Ayacucho 1621<br>Cel: 3875729428";
}else{
nombreVendedor="02 Analia A.Papeleria";
datosVendedor="Local: Salta Cap. - Ayacucho 1621<br>Cel: 3872254054";
}

let detalles=document.getElementsByClassName("detalle");
let cantidades=document.getElementsByClassName("cantidad");
let precios=document.getElementsByClassName("precio");

let totalPedido=0;
let filas="";

for(let i=0;i<detalles.length;i++){

if(detalles[i].value!=""){

let cant=parseFloat(cantidades[i].value) || 0;
let precio=parseFloat(precios[i].value) || 0;

totalPedido+=cant*precio;

filas+=`
<tr>
<td style="border:1px solid #000;padding:4px;background:white;color:black;">
${detalles[i].value}
</td>

<td style="border:1px solid #000;padding:4px;text-align:center;background:white;color:black;">
${cant}
</td>

<td style="border:1px solid #000;padding:4px;text-align:right;background:white;color:black;">
${formatoARS(precio)}
</td>
</tr>
`;

}

}

if(totalPedido==0){
alert("Agregue productos");
return;
}

let sena=parseFloat(document.getElementById("sena").value) || 0;
let porcentaje=parseFloat(document.getElementById("descuento").value) || 0;

let descuento=totalPedido*(porcentaje/100);
let totalFinal=totalPedido-descuento;
let pendiente=totalFinal-sena;

if(pendiente<0)pendiente=0;

let fecha=new Date().toLocaleDateString("es-AR");
let numeroFormateado=numero.toString().padStart(6,'0');

const comprobante=`
<div style="
width:190mm;
height:130mm;
margin:auto;
padding:6mm;
border:1px solid black;
background:white;
font-family:Arial;
box-sizing:border-box;
">

<div style="text-align:center;">
<img src="logo.png" style="width:130px;">
</div>

<div style="display:flex;justify-content:space-between;font-size:12px;margin-top:6px;">

<div>
Nº Recibo: ${numeroFormateado}<br>
Cliente: ${cliente}
</div>

<div style="text-align:right;">
Fecha: ${fecha}<br>
Vendedor: ${nombreVendedor}
</div>

</div>

<table style="width:100%;border-collapse:collapse;font-size:12px;margin-top:6px;">

<tr>
<th style="border:1px solid black;background:white;color:black;">Detalle</th>
<th style="border:1px solid black;background:white;color:black;">Cantidad</th>
<th style="border:1px solid black;background:white;color:black;">Precio</th>
</tr>

${filas}

</table>

<div style="display:flex;justify-content:space-between;font-size:12px;margin-top:10px;">

<div>
${nombreVendedor}<br>
${datosVendedor}
</div>

<div style="text-align:right;">
Total Pedido: ${formatoARS(totalPedido)}<br>
Descuento: ${formatoARS(descuento)}<br>
Seña: ${formatoARS(sena)}<br>

<b>
Saldo Pendiente: ${formatoARS(pendiente)}
</b>
</div>

</div>

</div>
`;

const hoja=`
<div style="width:210mm;height:297mm;background:white;margin:auto;">

<div style="margin-top:8mm;">
${comprobante}
</div>

<div style="border-top:2px dashed black;width:190mm;margin:8mm auto;"></div>

<div>
${comprobante}
</div>

</div>
`;

document.getElementById("resultado").innerHTML=hoja;

}

function guardarPDF(){

let elemento=document.getElementById("resultado");

let opt = {
margin: [0,0,0,0],
filename: "Comprobante_Yikun.pdf",
image: { type: "jpeg", quality: 1 },
html2canvas: {
scale: 3,
useCORS: true
},
jsPDF: {
unit: "mm",
format: "a4",
orientation: "portrait"
},
pagebreak: { mode: ['avoid-all'] }
};

html2pdf().set(opt).from(elemento).save();

numero++;
localStorage.setItem("numeroYikun",numero);

}

</script>

</body>
</html>
