<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>YIKUN COMPROBANTE</title>
<style>
/* Página principal */
body { 
    font-family: Arial, sans-serif; 
    margin:20px; 
    background:#212838; 
    color:#FFFFFF;  
    font-weight:bold;
}
h2 { color:#FFFFFF; } 
label { display:block; margin-bottom:10px; color:#FFFFFF; font-weight:bold; }
input, select {
    font-weight:bold;
    padding:5px;
    border: 1px solid #374658;
    border-radius:4px;
    background:#212838;
    color:#FFFFFF; 
}
input::placeholder { color:#08C6AB; } 
table { 
    border-collapse: collapse; 
    width:100%; 
    margin-top:10px;
    background:#374658;
    color:#FFFFFF; 
    font-weight:bold;
}
th, td { 
    border: 1px solid #08C6AB; 
    padding:5px; 
    text-align:left; 
    font-weight:bold;
    color:#FFFFFF; 
}
button { 
    margin-top:10px; 
    padding:5px 10px; 
    background:#08C6AB; 
    color:#212838; 
    border:none; 
    cursor:pointer;
    font-weight:bold;
}
button:hover { background:#726EFF; color:#FFFFFF; }

/* Comprobante generado */
.comprobante { 
    border:1px solid #333; 
    padding:15px; 
    margin-top:20px; 
    width:700px; 
    background:#f5f5f5; 
    color:#333; 
    font-weight:bold;
}
.titulo-principal { 
    text-align:center; 
    font-size:28px; 
    font-weight:bold; 
    color:#000; /* YIKUN en negro */
}
.subtitulo { 
    text-align:center; 
    font-size:18px; 
    margin-bottom:10px; 
    color:#212838; 
}
.comprobante table { width:100%; border-collapse:collapse; background:#ffffff; color:#000; font-weight:bold;}
.comprobante th, .comprobante td { border:1px solid #333; padding:5px; text-align:left; font-weight:bold; color:#000; }

/* Parte superior: número recibo izquierda, fecha derecha */
.comprobante .top { display:flex; justify-content:space-between; margin-bottom:10px; font-weight:bold; }

/* Parte media: cliente izquierda, vendedor derecha */
.comprobante .medio { display:flex; justify-content:space-between; margin-bottom:10px; font-weight:bold; }

/* Parte inferior: vendedor izquierda, totales derecha */
.comprobante .inferior { display:flex; justify-content:space-between; margin-top:20px; }
.inferior-left { width:45%; font-weight:bold; }
.inferior-right { width:50%; text-align:right; font-weight:bold; }
.total-pendiente { font-weight:bold; color:#DC2626; font-size:28px; margin-top:10px; }
</style>
</head>
<body>

<h2>YIKUN COMPROBANTE</h2>

<label>Cliente/a: <input type="text" id="cliente" placeholder="Ingrese nombre del cliente"></label>

<label>Vendedor: 
<select id="vendedor">
    <option value="03">03 Lucas A.Grafica</option>
    <option value="02">02 Analia A.Papeleria</option>
</select>
</label>

<table id="tabla">
<tr>
    <th>Detalle</th>
    <th>Cantidad</th>
    <th>Precio Unit.</th>
</tr>
</table>
<button onclick="agregarFila()">Agregar Producto</button>

<label>Seña: <input type="number" id="sena" value="0" min="0"></label>

<label>Forma de pago: 
<select id="formaPago">
    <option value="Efectivo">Efectivo</option>
    <option value="Transferencia">Transferencia</option>
</select>
</label>

<label>Descuento:
<select id="descuento">
    <option value="0">0%</option>
    <option value="5">5%</option>
    <option value="10">10%</option>
    <option value="15">15%</option>
    <option value="20">20%</option>
</select>
</label>

<button onclick="generar()">Generar Comprobante</button>
<button onclick="guardarPDF()">Guardar como PDF</button>

<div id="resultado"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
let numero = localStorage.getItem("numeroYikun") || 3281;
numero = parseInt(numero);

function formatoARS(valor){ return "$" + valor.toLocaleString("es-AR", {minimumFractionDigits:0}); }

function agregarFila(){
    let tabla = document.getElementById("tabla");
    let fila = tabla.insertRow();
    fila.innerHTML = `
    <td><input type="text" class="detalle" placeholder="Producto"></td>
    <td><input type="number" class="cantidad" min="1" value="1"></td>
    <td><input type="number" class="precio" min="0" step="0.01" value="0"></td>
    `;
}
window.onload = agregarFila;

function generar(){
    let cliente = document.getElementById("cliente").value.trim();
    if(cliente === ""){ alert("Ingrese nombre del cliente"); return; }

    let detalles = document.getElementsByClassName("detalle");
    let cantidades = document.getElementsByClassName("cantidad");
    let precios = document.getElementsByClassName("precio");

    let totalPedido = 0;
    let filas = "";
    for(let i=0;i<detalles.length;i++){
        if(detalles[i].value.trim() !== ""){
            let cant = parseFloat(cantidades[i].value || 0);
            let precio = parseFloat(precios[i].value || 0);
            totalPedido += cant * precio;
            filas += `<tr>
                        <td>${detalles[i].value}</td>
                        <td>${cant} Uni.</td>
                        <td>${formatoARS(precio)}</td>
                    </tr>`;
        }
    }
    if(totalPedido === 0){ alert("Agregue al menos un producto"); return; }

    let sena = parseFloat(document.getElementById("sena").value || 0);
    let porcentaje = parseFloat(document.getElementById("descuento").value);
    let montoDescuento = totalPedido * (porcentaje / 100);
    let totalFinal = totalPedido - montoDescuento;
    let pendiente = totalFinal - sena;
    if(pendiente < 0) pendiente = 0;

    let fechaActual = new Date().toLocaleDateString("es-AR");
    let numeroFormateado = numero.toString().padStart(6,'0');

    let vendedorSeleccionado = document.getElementById("vendedor").value;
    let nombreVendedor = "";
    let datosVendedor = "";
    if(vendedorSeleccionado === "03"){
        nombreVendedor = "03 Lucas A.Grafica";
        datosVendedor = `Local: Salta Cap. - Ayacucho 1621<br>Cel: 3875729428`;
    } else if(vendedorSeleccionado === "02"){
        nombreVendedor = "02 Analia A.Papeleria";
        datosVendedor = `Local: Salta Cap. - Ayacucho 1621<br>Cel: 3872254054`;
    }
    let formaPago = document.getElementById("formaPago").value;

    let comprobanteHTML = `
        <div class="comprobante">
            <div class="titulo-principal">YIKUN</div>
            <div class="subtitulo">COMPROBANTE DE PAGO</div>
            <div class="top">
                <div>Recibo B - ${numeroFormateado}</div>
                <div>Fecha: ${fechaActual}</div>
            </div>
            <div class="medio">
                <div><strong>Cliente/a:</strong> ${cliente}</div>
                <div><strong>Vendedor:</strong> ${nombreVendedor}</div>
            </div>
            <table>
                <tr><th>Detalle</th><th>Cantidad</th><th>Precio Unit.</th></tr>
                ${filas}
            </table>
            <div class="inferior">
                <div class="inferior-left">
                    <p><strong>Vendedor:</strong> ${nombreVendedor}</p>
                    <p>${datosVendedor}</p>
                </div>
                <div class="inferior-right">
                    <p>Total Pedido: ${formatoARS(totalPedido)}</p>
                    <p>Descuento (${porcentaje}%): ${formatoARS(montoDescuento)}</p>
                    <p>Seña realizada (${formaPago}): ${formatoARS(sena)}</p>
                    <div class="total-pendiente">Total Pendiente: ${formatoARS(pendiente)}</div>
                </div>
            </div>
        </div>
    `;
    document.getElementById("resultado").innerHTML = comprobanteHTML;
    numero++;
    localStorage.setItem("numeroYikun", numero);
}

function guardarPDF() {
    const elemento = document.querySelector(".comprobante"); // Solo 1 comprobante
    if(!elemento){
        alert("Primero genere un comprobante");
        return;
    }
    var opt = {
        margin:       5,
        filename:     'Comprobante_Yikun.pdf',
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'mm', format: 'a5', orientation: 'portrait' } // A5
    };
    html2pdf().set(opt).from(elemento).save();
}
</script>
</body>
                              </html>
