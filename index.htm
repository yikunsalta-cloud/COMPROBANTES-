<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Yikun - Comprobante</title>

<style>

/* =========================
   ESTILO GENERAL
========================= */

body{
    font-family: Arial, sans-serif;
    background:#21273F;
    color:white;
    margin:20px;
}

/* =========================
   TABLA PRODUCTOS
========================= */

#tabla{
    width:100%;
    border-collapse:separate;
    border-spacing:0 10px;
}

#tabla th{
    background:#013337;
    padding:12px;
    text-align:left;
    border-radius:6px;
}

#tabla td{
    background:#1a2135;
    padding:10px;
    border-radius:6px;
}

#tabla td input{
    width:100%;
    box-sizing:border-box;
    padding:8px;
    border-radius:6px;
    border:1px solid #2e3b55;
    background:#111827;
    color:white;
}

/* =========================
   AREA RESULTADO A4
========================= */

#resultado{
    width:210mm;
    margin:20px auto;
}

/* =========================
   COMPROBANTE A4 DOBLE
========================= */

.comprobante{
    width:190mm;
    height:130mm;
    border:1px solid #333;
    padding:15mm;
    margin:5mm auto;
    background:#ffffff;
    color:#000;
    font-weight:bold;
    box-sizing:border-box;
    page-break-inside: avoid;
}

/* Logo */
.logo-comprobante{
    text-align:center;
    margin-bottom:8mm;
}

.logo-comprobante img{
    width:45mm;
    display:block;
    margin:0 auto;
}

/* Subtitulo */
.subtitulo{
    text-align:center;
    font-size:16px;
    margin-bottom:8mm;
}

/* Tabla comprobante */
.comprobante table{
    width:100%;
    border-collapse:collapse;
}

.comprobante th,
.comprobante td{
    border:1px solid #333;
    padding:4mm;
    text-align:left;
}

/* Secciones */
.top{
    display:flex;
    justify-content:space-between;
    margin-bottom:5mm;
}

.medio{
    margin-bottom:5mm;
}

.inferior{
    display:flex;
    justify-content:space-between;
    margin-top:8mm;
}

.inferior-left{ width:45%; }
.inferior-right{ width:50%; text-align:right; }

.total-pendiente{
    font-weight:bold;
    color:#DC2626;
    font-size:18px;
}

/* A4 */
@page{
    size:A4;
    margin:10mm;
}

@media print{
    body{ background:white; }
}

button{
    margin-top:15px;
    padding:10px 15px;
    border:none;
    background:#149EF6;
    color:white;
    cursor:pointer;
    border-radius:6px;
}

button:hover{
    background:#01F259;
    color:#000;
}

</style>
</head>
<body>

<h2>YIKUN COMPROBANTE</h2>

<label>Cliente/a:
<input type="text" id="cliente">
</label>

<br><br>

<table id="tabla">
<tr>
    <th>Detalle</th>
    <th>Cantidad</th>
    <th>Precio Unit.</th>
</tr>
</table>

<button onclick="agregarFila()">Agregar Producto</button>
<button onclick="generar()">Generar Comprobante</button>
<button onclick="guardarPDF()">Guardar PDF A4</button>

<div id="resultado"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>

let numero = 1;

function formatoARS(valor){
    return "$" + valor.toLocaleString("es-AR");
}

function agregarFila(){
    let tabla = document.getElementById("tabla");
    let fila = tabla.insertRow();
    fila.innerHTML = `
        <td><input type="text" class="detalle"></td>
        <td><input type="number" class="cantidad" value="1"></td>
        <td><input type="number" class="precio" value="0"></td>
    `;
}

window.onload = agregarFila;

function generar(){

    let cliente = document.getElementById("cliente").value.trim();
    if(cliente===""){ alert("Ingrese cliente"); return; }

    let detalles = document.getElementsByClassName("detalle");
    let cantidades = document.getElementsByClassName("cantidad");
    let precios = document.getElementsByClassName("precio");

    let totalPedido = 0;
    let filas = "";

    for(let i=0;i<detalles.length;i++){
        if(detalles[i].value.trim()!==""){
            let cant = parseFloat(cantidades[i].value || 0);
            let precio = parseFloat(precios[i].value || 0);
            totalPedido += cant*precio;
            filas += `
            <tr>
                <td>${detalles[i].value}</td>
                <td>${cant}</td>
                <td>${formatoARS(precio)}</td>
            </tr>`;
        }
    }

    if(totalPedido===0){ alert("Agregue producto"); return; }

    let fechaActual = new Date().toLocaleDateString("es-AR");
    let numeroFormateado = numero.toString().padStart(6,'0');

    let comprobanteHTML = "";

    for(let copia=0;copia<2;copia++){
        comprobanteHTML += `
        <div class="comprobante">

            <div class="logo-comprobante">
                <img src="logo.png">
            </div>

            <div class="subtitulo">COMPROBANTE DE PAGO</div>

            <div class="top">
                <div>Recibo B - ${numeroFormateado}</div>
                <div>Fecha: ${fechaActual}</div>
            </div>

            <div class="medio">
                <div><strong>Cliente/a:</strong> ${cliente}</div>
            </div>

            <table>
                <tr>
                    <th>Detalle</th>
                    <th>Cantidad</th>
                    <th>Precio Unit.</th>
                </tr>
                ${filas}
            </table>

            <div class="inferior">
                <div class="inferior-left">
                    Total Pedido: ${formatoARS(totalPedido)}
                </div>

                <div class="inferior-right">
                    <div class="total-pendiente">
                        Total: ${formatoARS(totalPedido)}
                    </div>
                </div>
            </div>

        </div>`;
    }

    document.getElementById("resultado").innerHTML = comprobanteHTML;

    numero++;
}

function guardarPDF(){
    const elemento = document.getElementById("resultado");

    var opt = {
        margin:5,
        filename:'Comprobante_Yikun.pdf',
        image:{ type:'jpeg', quality:0.98 },
        html2canvas:{ scale:2 },
        jsPDF:{ unit:'mm', format:'a4', orientation:'portrait' }
    };

    html2pdf().set(opt).from(elemento).save();
}

</script>

</body>
</html>
