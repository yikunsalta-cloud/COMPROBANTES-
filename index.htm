<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Yikun - Comprobantes</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>

/* =================== ESTILO GENERAL =================== */

body{
    margin:0;
    font-family: Arial, sans-serif;
    background:#FA551D;
    color:white;
}

/* LOGO SUPERIOR */

.header{
    text-align:center;
    padding:25px 0;
}

.header img{
    width:220px;
}

/* CONTENEDOR PRINCIPAL */

.container{
    display:flex;
    gap:20px;
    padding:20px;
}

/* PANEL IZQUIERDO */

.panel{
    background:#013337;
    padding:20px;
    border-radius:15px;
    width:380px;
}

.panel h3{
    margin-top:0;
}

input, select{
    width:100%;
    padding:10px;
    margin-top:6px;
    margin-bottom:12px;
    border:none;
    border-radius:6px;
    background:#21273F;
    color:white;
}

/* BOTONES */

button{
    border:none;
    cursor:pointer;
    font-weight:bold;
    border-radius:6px;
}

.btn-accion{
    background:#149EF6;
    color:white;
    padding:12px;
    width:100%;
    margin-top:10px;
}

.btn-agregar{
    background:#FA551D;
    color:white;
    padding:12px;
    width:100%;
    margin-top:15px;
}

/* =================== TABLA PRODUCTOS =================== */

.tabla-container{
    flex:1;
    background:#21273F;
    padding:20px;
    border-radius:15px;
}

table{
    width:100%;
    border-collapse:separate;
    border-spacing:12px 10px; /* separación real */
}

th{
    background:#013337;
    padding:12px;
    border-radius:8px;
    text-align:center;
}

td{
    padding:0;
}

td input{
    width:100%;
    box-sizing:border-box;
    padding:10px;
    border-radius:6px;
    border:1px solid #013337;
    background:#0f172a;
    color:white;
}
/* ====== RESULTADO PDF ====== */

#resultado{
    margin-top:30px;
}

</style>
</head>

<body>

<div class="header">
    <img src="logo.png">
</div>

<div class="container">

<div class="panel">

Cliente
<input id="cliente">

Vendedor
<select id="vendedor">
<option value="03">03 Lucas A.Grafica</option>
<option value="02">02 Analia A.Papeleria</option>
</select>

Seña
<input type="number" id="sena" value="0">

Descuento %
<input type="number" id="descuento" value="0">

<button class="btn-accion" onclick="generar()">GENERAR COMPROBANTE</button>
<button class="btn-accion" onclick="guardarPDF()">GUARDAR PDF</button>

</div>

<div style="flex:1;background:#21273F;padding:20px;border-radius:15px;">

<table id="tabla">
<tr>
<th>Detalle</th>
<th>Cantidad</th>
<th>Precio</th>
</tr>
<tr>
<td><input class="detalle"></td>
<td><input class="cantidad" type="number" value="1"></td>
<td><input class="precio" type="number" value="0"></td>
</tr>
</table>

<button class="btn-agregar" onclick="agregarFila()">AGREGAR PRODUCTO</button>

</div>

</div>

<div id="resultado"></div>

<script>

let numero = localStorage.getItem("numeroYikun");
if(!numero){ numero = 1; } else { numero = parseInt(numero); }

function formatoARS(num){
    return "$ " + num.toLocaleString("es-AR");
}

function agregarFila(){
    let tabla = document.getElementById("tabla");
    let fila = tabla.insertRow();
    fila.innerHTML = `
        <td><input class="detalle"></td>
        <td><input class="cantidad" type="number" value="1"></td>
        <td><input class="precio" type="number" value="0"></td>
    `;
}
function generar(){

    let cliente = document.getElementById("cliente").value.trim();
    if(cliente===""){ alert("Ingrese nombre del cliente"); return; }

    let vendedorSeleccionado = document.getElementById("vendedor").value;

    let nombreVendedor = "";
    let datosVendedor = "";

    if(vendedorSeleccionado === "03"){
        nombreVendedor = "03 Lucas A.Grafica";
        datosVendedor = "Local: Salta Cap. - Ayacucho 1621<br>Cel: 3875729428";
    }
    else if(vendedorSeleccionado === "02"){
        nombreVendedor = "02 Analia A.Papeleria";
        datosVendedor = "Local: Salta Cap. - Ayacucho 1621<br>Cel: 3872254054";
    }

    let detalles = document.getElementsByClassName("detalle");
    let cantidades = document.getElementsByClassName("cantidad");
    let precios = document.getElementsByClassName("precio");

    let totalPedido = 0;
    let filas = "";

    for(let i=0;i<detalles.length;i++){
        if(detalles[i].value!==""){
            let cant = parseFloat(cantidades[i].value || 0);
            let precio = parseFloat(precios[i].value || 0);
            totalPedido += cant * precio;

            <table style="width:100%;border-collapse:collapse;margin-bottom:10px;">
    <tr>
        <th style="background:#ffffff;color:#000;border:1px solid #ccc;padding:6px;">
            Detalle
        </th>
        <th style="background:#ffffff;color:#000;border:1px solid #ccc;padding:6px;">
            Cantidad
        </th>
        <th style="background:#ffffff;color:#000;border:1px solid #ccc;padding:6px;">
            Precio
        </th>
    </tr>
    ${filas}
</table>
    }

    if(totalPedido===0){ alert("Agregue productos"); return; }

    let sena = parseFloat(document.getElementById("sena").value || 0);
    let porcentaje = parseFloat(document.getElementById("descuento").value || 0);
    let descuento = totalPedido*(porcentaje/100);
    let totalFinal = totalPedido-descuento;
    let pendiente = totalFinal-sena;
    if(pendiente<0) pendiente=0;

    let fecha = new Date().toLocaleDateString("es-AR");
    let numeroFormateado = numero.toString().padStart(6,'0');

    let tipos = ["ORIGINAL", "DUPLICADO"];

    let comprobanteHTML = `
    <div style="
        width:210mm;
        min-height:297mm;
        background:white;
        padding:10mm;
        box-sizing:border-box;
        font-family:Arial, sans-serif;
        color:black;
    ">
    `;

    for(let i=0;i<2;i++){

        comprobanteHTML += `
        <div style="
            height:130mm;
            border:1px dashed #999;
            padding:12px;
            margin-bottom:5mm;
            box-sizing:border-box;
            position:relative;
            background:white;
            page-break-inside: avoid;
        ">

            <div style="position:absolute;top:10px;right:15px;font-weight:bold;font-size:14px;">
                ${tipos[i]}
            </div>

            <div style="text-align:center;margin-bottom:10px;">
                <img src="logo.png" style="width:110px;">
            </div>

            <div style="display:flex;justify-content:space-between;margin-bottom:10px;">
                <div>
                    <div><strong>Nº Recibo:</strong> ${numeroFormateado}</div>
                    <div><strong>Cliente:</strong> ${cliente}</div>
                </div>
                <div style="text-align:right;">
                    <div><strong>Fecha:</strong> ${fecha}</div>
                    <div><strong>Vendedor:</strong> ${nombreVendedor}</div>
                </div>
            </div>

            <table style="width:100%;border-collapse:collapse;margin-bottom:10px;">
                <tr>
                    <th style="border:1px solid #ccc;padding:6px;">Detalle</th>
                    <th style="border:1px solid #ccc;padding:6px;">Cantidad</th>
                    <th style="border:1px solid #ccc;padding:6px;">Precio</th>
                </tr>
                ${filas}
            </table>

            <div style="display:flex;justify-content:space-between;">
                <div>
                    <div><strong>${nombreVendedor}</strong></div>
                    <div>${datosVendedor}</div>
                </div>
                <div style="text-align:right;">
                    <div>Total Pedido: ${formatoARS(totalPedido)}</div>
                    <div>Descuento: ${formatoARS(descuento)}</div>
                    <div>Seña: ${formatoARS(sena)}</div>
                    <div style="margin-top:8px;font-size:18px;font-weight:bold;">
                        Saldo Pendiente: ${formatoARS(pendiente)}
                    </div>
                </div>
            </div>

        </div>
        `;
    }

    comprobanteHTML += `</div>`;

    document.getElementById("resultado").innerHTML = comprobanteHTML;

    numero++;
    localStorage.setItem("numeroYikun",numero);
}

function guardarPDF(){
    const elemento = document.getElementById("resultado");

    var opt = {
        margin: 0,
        filename: 'Comprobante_Yikun.pdf',
        image: { type: 'jpeg', quality: 1 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
        pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
    };

    html2pdf().set(opt).from(elemento).save();
}

</script>

</body>
</html>
