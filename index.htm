<!DOCTYPE html>
<html lang="es">
<head>

<meta charset="UTF-8">
<title>Yikun - Comprobantes</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>

body{
margin:0;
font-family:Arial;
background:#FA551D;
color:white;
}

.header{
text-align:center;
padding:25px 0;
}

.header img{
width:220px;
}

.container{
display:flex;
gap:20px;
padding:20px;
}

.panel{
background:#013337;
padding:20px;
border-radius:15px;
width:380px;
}

input,select{
width:100%;
padding:10px;
margin-top:6px;
margin-bottom:12px;
border:none;
border-radius:6px;
background:#21273F;
color:white;
}

button{
border:none;
cursor:pointer;
font-weight:bold;
border-radius:6px;
}

.btn-accion{
background:#149EF6;
color:white;
padding:12px;
width:100%;
margin-top:10px;
}

.btn-agregar{
background:#FA551D;
color:white;
padding:12px;
width:100%;
margin-top:15px;
}

table{
width:100%;
border-collapse:separate;
border-spacing:12px 10px;
}

th{
background:#013337;
padding:12px;
border-radius:8px;
text-align:center;
}

td input{
width:100%;
padding:10px;
border-radius:6px;
border:1px solid #013337;
background:#0f172a;
color:white;
}

#resultado{
margin:0 auto;
background:white;
}

</style>

</head>

<body>

<div class="header">
<img src="logo.png">
</div>

<div class="container">

<div class="panel">

Cliente
<input id="cliente">

Vendedor
<select id="vendedor">
<option value="03">03 Lucas A.Grafica</option>
<option value="02">02 Analia A.Papeleria</option>
</select>

Seña
<input type="number" id="sena" value="0">

Descuento %
<input type="number" id="descuento" value="0">

<button class="btn-accion" onclick="generar()">
GENERAR COMPROBANTE
</button>

<button class="btn-accion" onclick="guardarPDF()">
GUARDAR PDF
</button>

</div>

<div style="flex:1;background:#21273F;padding:20px;border-radius:15px;">

<table id="tabla">

<tr>
<th>Detalle</th>
<th>Cantidad</th>
<th>Precio</th>
</tr>

<tr>
<td><input class="detalle"></td>
<td><input class="cantidad" type="number" value="1"></td>
<td><input class="precio" type="number" value="0"></td>
</tr>

</table>

<button class="btn-agregar" onclick="agregarFila()">
AGREGAR PRODUCTO
</button>

</div>

</div>

<div id="resultado"></div>

<script>

let numero = localStorage.getItem("numeroYikun");

if(!numero){
numero=1;
}else{
numero=parseInt(numero);
}

function formatoARS(num){
return "$ "+num.toLocaleString("es-AR");
}

function agregarFila(){
let tabla=document.getElementById("tabla");
let fila=tabla.insertRow();

fila.innerHTML=`
<td><input class="detalle"></td>
<td><input class="cantidad" type="number" value="1"></td>
<td><input class="precio" type="number" value="0"></td>
`;
}
function generar(){
    let cliente = document.getElementById("cliente").value.trim();
    if(cliente === ""){ alert("Ingrese nombre del cliente"); return; }

    let detalles = document.getElementsByClassName("detalle");
    let cantidades = document.getElementsByClassName("cantidad");
    let precios = document.getElementsByClassName("precio");

    let totalPedido = 0;
    let filas = "";
    for(let i=0;i<detalles.length;i++){
        if(detalles[i].value.trim() !== ""){
            let cant = parseFloat(cantidades[i].value || 0);
            let precio = parseFloat(precios[i].value || 0);
            totalPedido += cant * precio;
            filas += `<tr>
                        <td>${detalles[i].value}</td>
                        <td>${cant} Uni.</td>
                        <td>${formatoARS(precio)}</td>
                    </tr>`;
        }
    }
    if(totalPedido === 0){ alert("Agregue al menos un producto"); return; }

    let sena = parseFloat(document.getElementById("sena").value || 0);
    let porcentaje = parseFloat(document.getElementById("descuento").value);
    let montoDescuento = totalPedido * (porcentaje / 100);
    let totalFinal = totalPedido - montoDescuento;
    let pendiente = totalFinal - sena;
    if(pendiente < 0) pendiente = 0;

    let fechaActual = new Date().toLocaleDateString("es-AR");
    let numeroFormateado = numero.toString().padStart(6,'0');

    let vendedorSeleccionado = document.getElementById("vendedor").value;
    let nombreVendedor = "";
    let datosVendedor = "";
    if(vendedorSeleccionado === "03"){
        nombreVendedor = "03 Lucas A.Grafica";
        datosVendedor = `Local: Salta Cap. - Ayacucho 1621<br>Cel: 3875729428`;
    } else if(vendedorSeleccionado === "02"){
        nombreVendedor = "02 Analia A.Papeleria";
        datosVendedor = `Local: Salta Cap. - Ayacucho 1621<br>Cel: 3872254054`;
    }

    let formaPago = document.getElementById("formaPago").value;

    let comprobanteHTML = "";

    for(let copia=0;copia<2;copia++){
        comprobanteHTML += `
        <div class="comprobante-maqueta">

            <div class="fila-top">
                <div>
                    Recibo<br>
                    <b>${numeroFormateado}</b>
                </div>

                <div class="logo-centro">
                    <img src="logo.png">
                </div>

                <div>
                    FECHA : ${fechaActual}<br>
                    NUMERO DE VENDEDOR<br>
                    DATOS DEL VENDEDOR
                </div>
            </div>

            <div class="cliente">
                Cliente/a : <b>${cliente}</b>
            </div>

            <table class="tabla-productos">
                <tr>
                    <th>Detalle</th>
                    <th>Cantidad</th>
                    <th>Precio Unit.</th>
                </tr>
                ${filas}
            </table>

            <div class="totales">
                <div>
                    <p><strong>Vendedor:</strong> ${nombreVendedor}</p>
                    <p>${datosVendedor}</p>
                </div>

                <div class="derecha">
                    <p>Total Pedido: ${formatoARS(totalPedido)}</p>
                    <p>Descuento (${porcentaje}%): ${formatoARS(montoDescuento)}</p>
                    <p>Seña realizada (${formaPago}): ${formatoARS(sena)}</p>
                    <div class="pendiente">
                        Total Pendiente: ${formatoARS(pendiente)}
                    </div>
                </div>
            </div>

        </div>

        ${copia===0 ? '<div class="linea-corte"></div>' : ''}
        `;
    }

    document.getElementById("resultado").innerHTML = comprobanteHTML;
    numero++;
    localStorage.setItem("numeroYikun", numero);
}
</script>

</body>
</html>
