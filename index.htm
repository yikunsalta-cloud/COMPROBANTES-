<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>YIKUN COMPROBANTE</title>

<style>

/* ------------------ ESTRUCTURA ORIGINAL ------------------ */

body{
    font-family: Arial, sans-serif;
}

/* TABLA PRODUCTOS (MEJORADA SIN CAMBIAR DISEÑO) */

table{
    width:100%;
    border-collapse:separate;
    border-spacing:0 6px; /* separación entre filas */
}

th{
    background:#013337;
    padding:10px;
    text-align:left;
}

td{
    padding:6px;
}

td input{
    width:100%;
    box-sizing:border-box; /* evita que invada la celda */
}

/* ------------------ COMPROBANTE ------------------ */

#resultado{
    background:white;
    color:black;
    padding:10mm;
    margin:0 auto;
    width:190mm; /* tamaño real A4 */
}

.comprobante{
    border:1px solid black;
    padding:15mm;
    margin:5mm auto;
    height:130mm; /* 2 por hoja A4 */
    box-sizing:border-box;
    page-break-inside: avoid;
}

.logo-comprobante{
    display:block;
    margin:0 auto 10px auto;
    max-width:150px;
}

.titulo-principal{
    text-align:center;
    font-size:24px;
    font-weight:bold;
}

.subtitulo{
    text-align:center;
    margin-bottom:10px;
}

.comprobante table{
    border-collapse:collapse;
    border-spacing:0;
}

.comprobante th,
.comprobante td{
    border:1px solid black;
    padding:5px;
}

.top{
    display:flex;
    justify-content:space-between;
    margin-bottom:10px;
}

.medio{
    margin-bottom:10px;
}

.inferior{
    display:flex;
    justify-content:space-between;
    margin-top:20px;
}

.total-pendiente{
    font-weight:bold;
    font-size:22px;
}

/* FORMATO A4 */

@page{
    size:A4;
    margin:10mm;
}

.duplicado{
    page-break-after: always;
}

</style>
</head>
<body>

<h2>YIKUN COMPROBANTE</h2>

<label>Cliente/a:
<input type="text" id="cliente">
</label>

<label>Vendedor:
<select id="vendedor">
<option value="03">03 Lucas A.Grafica</option>
<option value="02">02 Analia A.Papeleria</option>
</select>
</label>

<table id="tabla">
<tr>
<th>Detalle</th>
<th>Cantidad</th>
<th>Precio Unit.</th>
</tr>
</table>

<button onclick="agregarFila()">Agregar Producto</button>

<br><br>

<label>Seña:
<input type="number" id="sena" value="0">
</label>

<label>Forma de pago:
<select id="formaPago">
<option value="Efectivo">Efectivo</option>
<option value="Transferencia">Transferencia</option>
</select>
</label>

<label>Descuento:
<select id="descuento">
<option value="0">0%</option>
<option value="5">5%</option>
<option value="10">10%</option>
<option value="15">15%</option>
<option value="20">20%</option>
</select>
</label>

<br><br>

<button onclick="generar()">Generar Comprobante</button>
<button onclick="guardarPDF()">Guardar como PDF A4</button>

<div id="resultado"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>

let numero = localStorage.getItem("numeroYikun") || 3281;
numero = parseInt(numero);

function formatoARS(valor){
    return "$" + valor.toLocaleString("es-AR");
}

function agregarFila(){
    let tabla = document.getElementById("tabla");
    let fila = tabla.insertRow();
    fila.innerHTML = `
    <td><input type="text" class="detalle"></td>
    <td><input type="number" class="cantidad" value="1"></td>
    <td><input type="number" class="precio" value="0"></td>
    `;
}

window.onload = agregarFila;

function generar(){

    let cliente = document.getElementById("cliente").value;
    if(cliente===""){ alert("Ingrese nombre del cliente"); return; }

    let detalles = document.getElementsByClassName("detalle");
    let cantidades = document.getElementsByClassName("cantidad");
    let precios = document.getElementsByClassName("precio");

    let totalPedido = 0;
    let filas = "";

    for(let i=0;i<detalles.length;i++){
        if(detalles[i].value!==""){
            let cant = parseFloat(cantidades[i].value);
            let precio = parseFloat(precios[i].value);
            totalPedido += cant * precio;

            filas += `
            <tr>
                <td>${detalles[i].value}</td>
                <td>${cant}</td>
                <td>${formatoARS(precio)}</td>
            </tr>`;
        }
    }

    if(totalPedido===0){ alert("Agregue productos"); return; }

    let sena = parseFloat(document.getElementById("sena").value);
    let porcentaje = parseFloat(document.getElementById("descuento").value);
    let descuento = totalPedido*(porcentaje/100);
    let totalFinal = totalPedido-descuento;
    let pendiente = totalFinal-sena;
    if(pendiente<0) pendiente=0;

    let fecha = new Date().toLocaleDateString("es-AR");
    let numeroFormateado = numero.toString().padStart(6,'0');

    let comprobanteHTML="";

    for(let i=0;i<2;i++){

        comprobanteHTML+=`
        <div class="comprobante">

            <img src="logo.png" class="logo-comprobante">

            <div class="titulo-principal">YIKUN</div>
            <div class="subtitulo">COMPROBANTE DE PAGO</div>

            <div class="top">
                <div>Recibo B - ${numeroFormateado}</div>
                <div>Fecha: ${fecha}</div>
            </div>

            <div class="medio">
                <strong>Cliente:</strong> ${cliente}
            </div>

            <table>
            <tr>
                <th>Detalle</th>
                <th>Cantidad</th>
                <th>Precio</th>
            </tr>
            ${filas}
            </table>

            <div class="inferior">
                <div>
                    Total Pedido: ${formatoARS(totalPedido)}<br>
                    Descuento: ${formatoARS(descuento)}<br>
                    Seña: ${formatoARS(sena)}
                </div>
                <div class="total-pendiente">
                    Saldo Pendiente: ${formatoARS(pendiente)}
                </div>
            </div>

        </div>
        `;
    }

    document.getElementById("resultado").innerHTML = comprobanteHTML;

    numero++;
    localStorage.setItem("numeroYikun",numero);
}

function guardarPDF(){

    const elemento=document.getElementById("resultado");

    var opt={
        margin:0,
        filename:'Comprobante_Yikun.pdf',
        image:{type:'jpeg',quality:0.98},
        html2canvas:{scale:2},
        jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}
    };

    html2pdf().set(opt).from(elemento).save();
}

</script>
</body>
</html>
