<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Yikun - Comprobantes</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>

body{
    margin:0;
    font-family: Arial, sans-serif;
    background:#21273F;
    color:white;
}

/* HEADER */
.header{
    text-align:center;
    padding:20px;
}

.logo img{
    width:280px;
}

/* CONTENEDOR PRINCIPAL */
.container{
    display:flex;
    gap:20px;
    padding:20px;
    max-width:1200px;
    margin:auto;
}

/* PANEL IZQUIERDO */
.panel{
    background:#013337;
    padding:20px;
    border-radius:10px;
    width:380px;
}

.panel h3{
    margin-top:0;
}

/* INPUTS */
input, select{
    width:100%;
    padding:8px;
    margin-top:6px;
    margin-bottom:12px;
    border:none;
    border-radius:4px;
}

/* BOTONES */
button{
    border:none;
    cursor:pointer;
    font-family:"Arial Black";
}

.btn-accion{
    background:#149EF6;
    color:white;
    padding:12px;
    width:100%;
    margin-top:10px;
}

.btn-accion:hover{
    background:#01F259;
    color:#000;
}

.btn-agregar{
    background:#FA551D;
    color:white;
    padding:10px;
    width:100%;
    margin-top:10px;
}

.btn-agregar:hover{
    background:#149EF6;
}

/* TABLA PRODUCTOS */
.tabla-container{
    flex:1;
    background:#21273F;
    padding:20px;
    border-radius:10px;
}

th{
    background:#013337;
    padding:12px;
    color:white;
    border-bottom:2px solid #149EF6;
}

table{
    margin-top:15px;
}

table th, table td{
    border:1px solid #2e3b55;
    padding:8px;
}

td{
    background:#1a2135;
}
}

td input{
    width:100%;
}

/* RESULTADO PDF */
#resultado{
    background:white;
    color:black;
    padding:20px;
    margin:20px;
}

/* COMPROBANTE */
.comprobante{
    border:1px solid black;
    padding:20px;
    margin-bottom:20px;
    page-break-inside: avoid;
}

.logo-comprobante{
    text-align:center;
    width:100%;
    margin-bottom:15px;
}

.logo-comprobante img{
    width:180px;
    margin:0 auto;
    display:block;
}

.subtitulo{
    text-align:center;
    margin-bottom:10px;
    font-family:"Arial Black";
    font-size:20px;
}

.top{
    display:flex;
    justify-content:space-between;
}

table{
    margin-top:10px;
}

table th, table td{
    border:1px solid black;
    padding:5px;
}

.inferior{
    display:flex;
    justify-content:space-between;
    margin-top:10px;
}

.total-pendiente{
    font-size:18px;
    font-weight:bold;
}

</style>
</head>

<body>

<div class="header">
    <div class="logo">
        <img src="logo.png" alt="Yikun Logo">
    </div>
    <div>Sistema de comprobantes</div>
</div>

<div class="container">

<!-- PANEL -->
<div class="panel">

<h3>Datos del Cliente</h3>

Cliente
<input id="cliente">

Vendedor
<select id="vendedor">
<option value="03">03 Lucas A.Grafica</option>
<option value="02">02 Analia A.Papeleria</option>
</select>

Forma de pago
<select id="formaPago">
<option>Efectivo</option>
<option>Transferencia</option>
<option>Tarjeta</option>
</select>

Seña
<input type="number" id="sena">

Descuento %
<input type="number" id="descuento" value="0">

<button class="btn-accion" onclick="generar()">GENERAR COMPROBANTE</button>
<button class="btn-accion" onclick="guardarPDF()">GUARDAR PDF</button>

</div>

<!-- PRODUCTOS -->
<div class="tabla-container">

<h3>Productos</h3>

<table id="tabla">
<tr>
<th>Detalle</th>
<th>Cantidad</th>
<th>Precio</th>
</tr>

<tr>
<td><input class="detalle"></td>
<td><input class="cantidad" type="number"></td>
<td><input class="precio" type="number"></td>
</tr>

</table>

<button class="btn-agregar" onclick="agregarFila()">AGREGAR PRODUCTO</button>

</div>

</div>

<div id="resultado"></div>

<script>

let numero = localStorage.getItem("numeroYikun");
if(!numero){
    numero = 1;
}else{
    numero = parseInt(numero);
}

function formatoARS(num){
    return "$ " + num.toLocaleString("es-AR");
}

function agregarFila(){
    let tabla = document.getElementById("tabla");
    let fila = tabla.insertRow();

    fila.innerHTML = `
        <td><input class="detalle"></td>
        <td><input class="cantidad" type="number"></td>
        <td><input class="precio" type="number"></td>
    `;
}

function generar(){
    let cliente = document.getElementById("cliente").value.trim();
    if(cliente === ""){ alert("Ingrese nombre del cliente"); return; }

    let detalles = document.getElementsByClassName("detalle");
    let cantidades = document.getElementsByClassName("cantidad");
    let precios = document.getElementsByClassName("precio");

    let totalPedido = 0;
    let filas = "";
    for(let i=0;i<detalles.length;i++){
        if(detalles[i].value.trim() !== ""){
            let cant = parseFloat(cantidades[i].value || 0);
            let precio = parseFloat(precios[i].value || 0);
            totalPedido += cant * precio;
            filas += `<tr>
                        <td>${detalles[i].value}</td>
                        <td>${cant} Uni.</td>
                        <td>${formatoARS(precio)}</td>
                    </tr>`;
        }
    }

    if(totalPedido === 0){ alert("Agregue al menos un producto"); return; }

    let sena = parseFloat(document.getElementById("sena").value || 0);
    let porcentaje = parseFloat(document.getElementById("descuento").value || 0);
    let montoDescuento = totalPedido * (porcentaje / 100);
    let totalFinal = totalPedido - montoDescuento;
    let pendiente = totalFinal - sena;
    if(pendiente < 0) pendiente = 0;

    let fechaActual = new Date().toLocaleDateString("es-AR");
    let numeroFormateado = numero.toString().padStart(6,'0');

    let vendedorSeleccionado = document.getElementById("vendedor").value;
    let nombreVendedor = "";
    let datosVendedor = "";

    if(vendedorSeleccionado === "03"){
        nombreVendedor = "03 Lucas A.Grafica";
        datosVendedor = `Local: Salta Cap. - Ayacucho 1621<br>Cel: 3875729428`;
    } else {
        nombreVendedor = "02 Analia A.Papeleria";
        datosVendedor = `Local: Salta Cap. - Ayacucho 1621<br>Cel: 3872254054`;
    }

    let formaPago = document.getElementById("formaPago").value;

    let comprobanteHTML = "";

    for(let copia=0;copia<2;copia++){
        comprobanteHTML += `
        <div class="comprobante">

            <div class="logo-comprobante">
                <img src="logo.png">
            </div>

            <div class="subtitulo">COMPROBANTE DE PAGO</div>

            <div class="top">
                <div>Recibo B - ${numeroFormateado}</div>
                <div>Fecha: ${fechaActual}</div>
            </div>

            <p><strong>Cliente:</strong> ${cliente}</p>

            <table>
                <tr><th>Detalle</th><th>Cantidad</th><th>Precio</th></tr>
                ${filas}
            </table>

            <div class="inferior">
                <div>
                    <p><strong>Vendedor:</strong> ${nombreVendedor}</p>
                    <p>${datosVendedor}</p>
                </div>

                <div>
                    <p>Total Pedido: ${formatoARS(totalPedido)}</p>
                    <p>Descuento (${porcentaje}%): ${formatoARS(montoDescuento)}</p>
                    <p>Seña (${formaPago}): ${formatoARS(sena)}</p>
                    <div class="total-pendiente">Pendiente: ${formatoARS(pendiente)}</div>
                </div>
            </div>

        </div>`;
    }

    document.getElementById("resultado").innerHTML = comprobanteHTML;

    numero++;
    localStorage.setItem("numeroYikun", numero);
}

function guardarPDF() {
    const elemento = document.getElementById("resultado");
    if(!elemento){
        alert("Primero genere un comprobante");
        return;
    }

    var opt = {
        margin: 5,
        filename: 'Comprobante_Yikun.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };

    html2pdf().set(opt).from(elemento).save();
}

</script>

</body>
</html>
